(window.webpackJsonp=window.webpackJsonp||[]).push([[121],{593:function(t,s,a){"use strict";a.r(s);var n=a(35),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("“我报名参加金石计划 1 期挑战——瓜分 10 万奖池，这是我的第 2 篇文章，"),a("a",{attrs:{href:"https://s.juejin.cn/ds/jooSN7t",title:"https://s.juejin.cn/ds/jooSN7t",target:"_blank",rel:"noopener noreferrer"}},[t._v("点击查看活动详情"),a("OutboundLink")],1),t._v("”")]),t._v(" "),a("h2",{attrs:{id:"前置知识"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前置知识"}},[t._v("#")]),t._v(" 前置知识")]),t._v(" "),a("p",[t._v("回答这个问题之前需要具备一些 webpack-cli 的前置知识。首先我们可以检验一下对 webpack-cli 的理解情况？")]),t._v(" "),a("ol",[a("li",[t._v("为什么要使用 webpack-cli？")]),t._v(" "),a("li",[t._v("怎么使用呢？")]),t._v(" "),a("li",[t._v("能否判断出什么样的情况下是使用了 webpack-cli，什么情况下是直接使用 wepack 的 Node.js API？")]),t._v(" "),a("li",[t._v("使用它有什么好处？")]),t._v(" "),a("li",[t._v("是必须要用的吗？")]),t._v(" "),a("li",[t._v("。。。")])]),t._v(" "),a("p",[t._v("如果能回答出这些问题，说明对 webpack-cli 有一定的认识，如果有不明确的可以查阅一些资料，补充这部分的知识。")]),t._v(" "),a("p",[t._v("官方文档介绍")]),t._v(" "),a("p",[t._v("命令行接口（CLI）：为了更合适且方便地使用配置，可以在 webpack.config.js 中对 webpack 进行配置。CLI 中传入的任何参数会在配置文件中映射为对应的参数。")]),t._v(" "),a("blockquote",[a("p",[a("a",{attrs:{href:"https://webpack.js.org/api/cli",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://webpack.js.org/api/cli"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://webpack.docschina.org/api/cli/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://webpack.docschina.org/api/cli/"),a("OutboundLink")],1)])]),t._v(" "),a("h2",{attrs:{id:"使用-webpack-cli"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-webpack-cli"}},[t._v("#")]),t._v(" 使用 webpack-cli")]),t._v(" "),a("p",[t._v("index.js")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" sum "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./sum"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("p",[t._v("sum.js")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" a "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("p",[t._v("示例一：")]),t._v(" "),a("p",[t._v("命令行运行")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("npx webpack --entry ./index.js --output-path build\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("执行情况：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f3686008dc01462ab518bc2edd263561~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/37adf14be20d49a68c2db7b1ab57845b~tplv-k3u1fbpfcp-zoom-1.image",alt:""}})]),t._v(" "),a("p",[t._v("示例二：")]),t._v(" "),a("p",[t._v("webpack.config.js")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"path"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  entry"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./index.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  output"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    path"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"build"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  mode"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"none"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// npx webpack --entry ./index.js --output-path build")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])]),a("p",[t._v("命令行运行")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("npx webpack\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("执行结果：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ee2ddf9f686843b5a12ec5cda18c5a0d~tplv-k3u1fbpfcp-zoom-1.image",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("接下来想通过调试源码的方式，去看 webpack 与 webpack-cli 的工作流程。")])]),t._v(" "),a("h2",{attrs:{id:"开始调试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开始调试"}},[t._v("#")]),t._v(" 开始调试")]),t._v(" "),a("h3",{attrs:{id:"思路一"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#思路一"}},[t._v("#")]),t._v(" 思路一")]),t._v(" "),a("p",[t._v("我们知道，在使用 webpack-cli 的时候，实际会去找 node_modules webpack、webpack-cli 依赖包 package.json 中定义的 bin 字段所对应的文件")]),t._v(" "),a("p",[t._v("bin 字段用来指定各个内部命令对应的可执行文件的位置")]),t._v(" "),a("blockquote",[a("p",[a("a",{attrs:{href:"https://docs.npmjs.com/cli/v8/configuring-npm/package-json/#bin",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://docs.npmjs.com/cli/v8/configuring-npm/package-json/#bin"),a("OutboundLink")],1)])]),t._v(" "),a("p",[t._v("webpack")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3fa1c5b5208d402b9beb155c9eac7f28~tplv-k3u1fbpfcp-zoom-1.image",alt:""}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/07dbd3d665d147818fcc0c2ce1aabd18~tplv-k3u1fbpfcp-zoom-1.image",alt:""}})]),t._v(" "),a("p",[t._v("在第 8 行打个断点")]),t._v(" "),a("p",[t._v("webpack-cli")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/eabad21da14444869555c5bbc894d8ac~tplv-k3u1fbpfcp-zoom-1.image",alt:""}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dfe1c53f751f4bbeb99ae45f59aa57e8~tplv-k3u1fbpfcp-zoom-1.image",alt:""}})]),t._v(" "),a("p",[t._v("第 5 行打断点")]),t._v(" "),a("blockquote",[a("p",[t._v("我自己在调试过程中，感觉这种方式需要不断去找去试，有时候可能就一不小心跳过关键代码了，就需要重新调试一遍。")]),t._v(" "),a("p",[t._v("所以就想着能不能换种思路跟代码，于是有了思路二，见下文。")])]),t._v(" "),a("h3",{attrs:{id:"思路二"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#思路二"}},[t._v("#")]),t._v(" 思路二")]),t._v(" "),a("p",[t._v("观察控制台的日志")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/94ab358471304e949fb1c4b342daad4d~tplv-k3u1fbpfcp-zoom-1.image",alt:""}})]),t._v(" "),a("p",[t._v("说明默认会自动执行计算编译时间，应该也是通过 stats 得到的，所以可以借用 "),a("a",{attrs:{href:"https://juejin.cn/post/7141528750629814286",target:"_blank",rel:"noopener noreferrer"}},[t._v("Webpack 是如何计算编译时间的?"),a("OutboundLink")],1),t._v(" 一文中找到的关键断点位置，打断点")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/75dfe977d0914bf9a43548f362b3628d~tplv-k3u1fbpfcp-zoom-1.image",alt:""}})]),t._v(" "),a("p",[t._v("重新通过 JavaScript Debug Terminal 运行命令 npx webpack，看是否能进入断点")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b3b4f5c3126245b392f1b08a3614cb4f~tplv-k3u1fbpfcp-zoom-1.image",alt:""}})]),t._v(" "),a("p",[t._v("进入断点处，发现左边调用堆栈有一堆东西，点进去看看，发现是 webpack Compiler、Compilation 等的一些执行，我们现在先不关心，因为我们要找 webpack-cli 做了些什么事情")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/35aaf3a3689341edbd2f765ee6790569~tplv-k3u1fbpfcp-zoom-1.image",alt:""}})]),t._v(" "),a("p",[t._v("将调用堆栈拖动到最底部，在这个关键位置（第 1789 行）打一个断点，猜测是在这里构建 compiler 对象，然后进行一系列打包，")]),t._v(" "),a("p",[t._v("断开调试，然后在重新输入 npx webpack 开启调试")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/49565a3cb702457694ff9bd373206746~tplv-k3u1fbpfcp-zoom-1.image",alt:""}})]),t._v(" "),a("p",[t._v("进入断点处，观察左侧调用堆栈，出现了一些关键的调用")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/244fc90aa0b14246b61b3f8113279191~tplv-k3u1fbpfcp-zoom-1.image",alt:""}})]),t._v(" "),a("p",[t._v("因为 webpack-cli 第 1789 行开始构建 compiler 对象，后续就要处理打包了，那说明之前就有 webpack-cli 处理命令行参数的相关逻辑，")]),t._v(" "),a("p",[t._v("这时候就可以从下往上依次看看调用情况，接下来就可以逐个打上断点，再从头调试一遍，基本就会比较清晰了，具体内容见下文。")]),t._v(" "),a("h2",{attrs:{id:"调试分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#调试分析"}},[t._v("#")]),t._v(" 调试分析")]),t._v(" "),a("p",[t._v("关键步骤截图并分析")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("首先在控制台执行 npx webpack 发生了什么")]),t._v(" "),a("ul",[a("li",[t._v("如果正常安装了依赖，会去执行 "),a("code",[t._v("webpack/bin/webpack.js")])])])]),t._v(" "),a("li",[a("p",[t._v("判断 webpack-cli 是否安装，没有安装则提示安装，如果安装了，就到标记 2 的位置，执行 runCli 函数，再执行到标记 3 的位置，"),a("code",[t._v("require(path.resolve(path.dirname(pkgPath), pkg.bin[cli.binName]))")]),t._v("; 这里通过 "),a("code",[t._v("require")]),t._v(" 将 "),a("code",[t._v("webpack-cli")]),t._v(" 引入并执行")]),t._v(" "),a("ul",[a("li",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3fd21e500b99452fa343a609d8f95336~tplv-k3u1fbpfcp-zoom-1.image",alt:""}})])])]),t._v(" "),a("li",[a("p",[t._v("进入到 node_modules\\webpack-cli\\bin\\cli.js")])]),t._v(" "),a("li",[a("p",[t._v("中间这些过程省略，大家自行分析一下")]),t._v(" "),a("ul",[a("li",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bf26a6a9716e4db09c344bffe71d46a2~tplv-k3u1fbpfcp-zoom-1.image",alt:""}})])])]),t._v(" "),a("li",[a("p",[t._v("执行到 node_modules\\webpack-cli\\lib\\webpack-cli.js 中的 createCompiler 函数，这里面有一个关键点")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" config "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("loadConfig")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconfig "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("buildConfig")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])])]),t._v(" "),a("li",[a("p",[t._v("先进入到 loadConfig 函数中")]),t._v(" "),a("ul",[a("li",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1f0a947c057c415e87bf6d1f1e91b894~tplv-k3u1fbpfcp-zoom-1.image",alt:""}})]),t._v(" "),a("li",[t._v("这里判断我们在 npx webpack 后面有没有跟对应的配置参数，如果有的话，走 if 里的逻辑，如果没有的话，走 else 里的逻辑；")]),t._v(" "),a("li",[t._v("我们这个例子中，直接是 npx webpack，所以会走 else，else 内有 defaultConfigFiles，这几个就是 webpack-cli 的默认配置文件，然后会去解析里面的配置信息，得到 config")]),t._v(" "),a("li",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a2ec978e2731416cb5bcbab7296884a3~tplv-k3u1fbpfcp-zoom-1.image",alt:""}})])])]),t._v(" "),a("li",[a("p",[t._v("然后创建 compiler，接下来就正式开始编译工作了")])]),t._v(" "),a("li",[a("p",[t._v("进入到 node_modules\\webpack\\lib\\webpack.js，执行 compiler.run()")]),t._v(" "),a("ul",[a("li",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6f4563b09d0842b2ae6290ec90555934~tplv-k3u1fbpfcp-zoom-1.image",alt:""}})])])])]),t._v(" "),a("blockquote",[a("p",[t._v("在 "),a("a",{attrs:{href:"https://juejin.cn/post/7141528750629814286",target:"_blank",rel:"noopener noreferrer"}},[t._v("Webpack 是如何计算编译时间的?"),a("OutboundLink")],1),t._v(" 文中，是通过 Webpack 的 Node.js API 手动调用 compiler.run")])]),t._v(" "),a("h2",{attrs:{id:"补充知识点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#补充知识点"}},[t._v("#")]),t._v(" 补充知识点")]),t._v(" "),a("h3",{attrs:{id:"npx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#npx"}},[t._v("#")]),t._v(" npx")]),t._v(" "),a("blockquote",[a("p",[t._v("npx commandname 执行流程")]),t._v(" "),a("ol",[a("li",[t._v("在 node_modules/.bin 目录下查找 commandname 命令是否存在，如果存在，就执行，如果不存在，到第 2 步；")]),t._v(" "),a("li",[t._v("在环境变量 $PATH 里，检查 commandname 是否存在，如果存在，就执行，如果不存在，到第 3 步;")]),t._v(" "),a("li",[t._v("将 commandname 下载到一个临时目录，使用以后再删除。")])])]),t._v(" "),a("p",[t._v("这里以项目中安装了 webpack 依赖包为例")]),t._v(" "),a("ol",[a("li",[t._v("控制台执行 npx webpack 命令")]),t._v(" "),a("li",[t._v("去找 node_modules/.bin 目录下去找有没有 webpack 命令，如果有，就执行它\n"),a("ul",[a("li",[t._v("windows 用户")]),t._v(" "),a("li",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/81e3fec367874926a3168df78ab19c52~tplv-k3u1fbpfcp-zoom-1.image",alt:""}})])])])]),t._v(" "),a("blockquote",[a("p",[t._v('补充：这里的 node_modules/.bin/webpack.cmd 是在 npm install webpack -D 的时候生成的，该文件 "%dp0%..\\webpack\\bin\\webpack.js" 是在 webpack package.json 的 bin 字段指定的')]),t._v(" "),a("p",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ff681d8f93724a0c822af3dc610af8a8~tplv-k3u1fbpfcp-zoom-1.image",alt:""}})])]),t._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[t._v("执行 webpack/bin/webpack.js 文件")])]),t._v(" "),a("h2",{attrs:{id:"小结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[t._v("#")]),t._v(" 小结")]),t._v(" "),a("p",[t._v("本文通过对源码的调试，对 webpack-cli 应该有一定的认识")]),t._v(" "),a("ol",[a("li",[t._v("可以处理命令行参数")]),t._v(" "),a("li",[t._v("可以对 webpack 的默认配置文件进行处理")])]),t._v(" "),a("p",[t._v("也就是说我们有三种方式可以让 webpack 工作：")]),t._v(" "),a("ol",[a("li",[t._v("不用 webpack-cli，使用 webpack Node.js API，")])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" webpack "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"webpack"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"path"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("build1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("webpack")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    entry"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./index.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    output"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      path"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"build"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    mode"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"none"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("build1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" stat")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" startTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" stat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("startTime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" endTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" stat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("endTime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"构建时间"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" endTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" startTime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// console.log("构建时间", stat.endTime - stat.startTime);')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("使用 webpack-cli，传入命令行参数")])]),t._v(" "),a("p",[t._v("在控制台执行")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("npx webpack --entry ./index.js --output-path build --mode"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("none\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[t._v("使用 webpack-cli，使用配置文件进行配置")])]),t._v(" "),a("p",[t._v("webpack.config.js")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"path"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  entry"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./index.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  output"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    path"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"build"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  mode"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"none"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br")])]),a("h2",{attrs:{id:"参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://nodejs.dev/en/learn/the-npx-nodejs-package-runner/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://nodejs.dev/en/learn/the-npx-nodejs-package-runner/"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://www.npmjs.com/package/npx",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.npmjs.com/package/npx"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://www.ruanyifeng.com/blog/2019/02/npx.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.ruanyifeng.com/blog/2019/02/npx.html"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://webpack.js.org/api/cli",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://webpack.js.org/api/cli"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://webpack.docschina.org/api/cli/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://webpack.docschina.org/api/cli/"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://docs.npmjs.com/cli/v8/configuring-npm/package-json/#bin",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://docs.npmjs.com/cli/v8/configuring-npm/package-json/#bin"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=e.exports}}]);